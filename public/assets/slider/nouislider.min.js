// var slider = document.getElementById('slider');
//
// noUiSlider.create(slider, {
//     start: [20, 80],
//     connect: true,
//     range: {
//         'min': 0,
//         'max': 100
//     }
// });
// (function() {
//
//     function addSeparator(nStr) {
//         nStr += '';
//         var x = nStr.split('.');
//         var x1 = x[0];
//         var x2 = x.length > 1 ? '.' + x[1] : '';
//         var rgx = /(\d+)(\d{3})/;
//         while (rgx.test(x1)) {
//             x1 = x1.replace(rgx, '$1' + '.' + '$2');
//         }
//         return x1 + x2;
//     }
//
//     function rangeInputChangeEventHandler(e){
//         var rangeGroup = $(this).attr('name'),
//             minBtn = $(this).parent().children('.min'),
//             maxBtn = $(this).parent().children('.max'),
//             range_min = $(this).parent().children('.range_min'),
//             range_max = $(this).parent().children('.range_max'),
//             minVal = parseInt($(minBtn).val()),
//             maxVal = parseInt($(maxBtn).val()),
//             origin = $(this).context.className;
//
//         if(origin === 'min' && minVal > maxVal-5){
//             $(minBtn).val(maxVal-5);
//         }
//         var minVal = parseInt($(minBtn).val());
//         $(range_min).html(addSeparator(minVal*1000) + ' €');
//
//
//         if(origin === 'max' && maxVal-5 < minVal){
//             $(maxBtn).val(5+ minVal);
//         }
//         var maxVal = parseInt($(maxBtn).val());
//         $(range_max).html(addSeparator(maxVal*1000) + ' €');
//     }
//
//     $('input[type="range"]').on( 'input', rangeInputChangeEventHandler);
// })();
//
//




//
//
//
// var thumbsize = 14;
//
// function draw(slider,splitvalue) {
//
//     /* set function vars */
//     var min = slider.querySelector('.min');
//     var max = slider.querySelector('.max');
//     var lower = slider.querySelector('.lower');
//     var upper = slider.querySelector('.upper');
//     var lower = slider.querySelector('.lower');
//     var upper = slider.querySelector('.upper');
//     var legend = slider.querySelector('.legend');
//     var thumbsize = parseInt(slider.getAttribute('data-thumbsize'));
//     var rangewidth = parseInt(slider.getAttribute('data-rangewidth'));
//     var rangemin = parseInt(slider.getAttribute('data-rangemin'));
//     var rangemax = parseInt(slider.getAttribute('data-rangemax'));
//
//     /* set min and max attributes */
//     min.setAttribute('max',splitvalue);
//     max.setAttribute('min',splitvalue);
//
//     /* set css */
//     min.style.width = parseInt(thumbsize + ((splitvalue - rangemin)/(rangemax - rangemin))*(rangewidth - (2*thumbsize)))+'px';
//     max.style.width = parseInt(thumbsize + ((rangemax - splitvalue)/(rangemax - rangemin))*(rangewidth - (2*thumbsize)))+'px';
//     min.style.left = '0px';
//     max.style.left = parseInt(min.style.width)+'px';
//     min.style.top = lower.offsetHeight+'px';
//     max.style.top = lower.offsetHeight+'px';
//     legend.style.marginTop = min.offsetHeight+'px';
//     slider.style.height = (lower.offsetHeight + min.offsetHeight + legend.offsetHeight)+'px';
//
//     /* correct for 1 off at the end */
//     if(max.value>(rangemax - 1)) max.setAttribute('data-value',rangemax);
//
//     /* write value and labels */
//     max.value = max.getAttribute('data-value');
//     min.value = min.getAttribute('data-value');
//     lower.innerHTML = min.getAttribute('data-value');
//     upper.innerHTML = max.getAttribute('data-value');
//
// }
//
// function init(slider) {
//     /* set function vars */
//     var min = slider.querySelector('.min');
//     var max = slider.querySelector('.max');
//     var rangemin = parseInt(min.getAttribute('min'));
//     var rangemax = parseInt(max.getAttribute('max'));
//     var avgvalue = (rangemin + rangemax)/2;
//     var legendnum = slider.getAttribute('data-legendnum');
//
//     /* set data-values */
//     min.setAttribute('data-value',rangemin);
//     max.setAttribute('data-value',rangemax);
//
//     /* set data vars */
//     slider.setAttribute('data-rangemin',rangemin);
//     slider.setAttribute('data-rangemax',rangemax);
//     slider.setAttribute('data-thumbsize',thumbsize);
//     slider.setAttribute('data-rangewidth',slider.offsetWidth);
//
//     /* write labels */
//     var lower = document.createElement('span');
//     var upper = document.createElement('span');
//     lower.classList.add('lower','value');
//     upper.classList.add('upper','value');
//     lower.appendChild(document.createTextNode(rangemin));
//     upper.appendChild(document.createTextNode(rangemax));
//     slider.insertBefore(lower,min.previousElementSibling);
//     slider.insertBefore(upper,min.previousElementSibling);
//
//     /* write legend */
//     var legend = document.createElement('div');
//     legend.classList.add('legend');
//     var legendvalues = [];
//     for (var i = 0; i < legendnum; i++) {
//         legendvalues[i] = document.createElement('div');
//         var val = Math.round(rangemin+(i/(legendnum-1))*(rangemax - rangemin));
//         legendvalues[i].appendChild(document.createTextNode(val));
//
//
//     }
//     slider.appendChild(legend);
//
//     /* draw */
//     draw(slider,avgvalue);
//
//     /* events */
//     min.addEventListener("input", function() {update(min);});
//     max.addEventListener("input", function() {update(max);});
// }
//
// function update(el){
//     /* set function vars */
//     var slider = el.parentElement;
//     var min = slider.querySelector('#min');
//     var max = slider.querySelector('#max');
//     var minvalue = Math.floor(min.value);
//     var maxvalue = Math.floor(max.value);
//
//     /* set inactive values before draw */
//     min.setAttribute('data-value',minvalue);
//     max.setAttribute('data-value',maxvalue);
//
//     var avgvalue = (minvalue + maxvalue)/2;
//
//     /* draw */
//     draw(slider,avgvalue);
// }
//
// var sliders = document.querySelectorAll('.min-max-slider');
// sliders.forEach( function(slider) {
//     init(slider);
// });
//
//




function controlFromInput(fromSlider, fromInput, toInput, controlSlider) {
    const [from, to] = getParsed(fromInput, toInput);
    fillSlider(fromInput, toInput, '#343434', '#343434', controlSlider);
    if (from > to) {
        fromSlider.value = to;
        fromInput.value = to;
    } else {
        fromSlider.value = from;
    }
}

function controlToInput(toSlider, fromInput, toInput, controlSlider) {
    const [from, to] = getParsed(fromInput, toInput);
    fillSlider(fromInput, toInput, '#343434', '#343434', controlSlider);
    setToggleAccessible(toInput);
    if (from <= to) {
        toSlider.value = to;
        toInput.value = to;
    } else {
        toInput.value = from;
    }
}

function controlFromSlider(fromSlider, toSlider, fromInput) {
    const [from, to] = getParsed(fromSlider, toSlider);
    fillSlider(fromSlider, toSlider, '#9d9b9b', '#343434', toSlider);
    if (from > to) {
        fromSlider.value = to;
        fromInput.value = to;
    } else {
        fromInput.value = from;
    }
}

function controlToSlider(fromSlider, toSlider, toInput) {
    const [from, to] = getParsed(fromSlider, toSlider);
    fillSlider(fromSlider, toSlider, '#9d9b9b', '#343434', toSlider);
    setToggleAccessible(toSlider);
    if (from <= to) {
        toSlider.value = to;
        toInput.value = to;
    } else {
        toInput.value = from;
        toSlider.value = from;
    }
}

function getParsed(currentFrom, currentTo) {
    const from = parseInt(currentFrom.value, 10);
    const to = parseInt(currentTo.value, 10);
    return [from, to];
}

function fillSlider(from, to, sliderColor, rangeColor, controlSlider) {
    const rangeDistance = to.max - to.min;
    const fromPosition = from.value - to.min;
    const toPosition = to.value - to.min;
    controlSlider.style.background = `linear-gradient(
      to right,
      ${sliderColor} 0%,
      ${sliderColor} ${(fromPosition) / (rangeDistance) * 100}%,
      ${rangeColor} ${((fromPosition) / (rangeDistance)) * 100}%,
      ${rangeColor} ${(toPosition) / (rangeDistance) * 100}%, 
      ${sliderColor} ${(toPosition) / (rangeDistance) * 100}%, 
      ${sliderColor} 100%)`;
}

function setToggleAccessible(currentTarget) {
    const toSlider = document.querySelector('#toSlider');
    if (Number(currentTarget.value) <= 0) {
        toSlider.style.zIndex = 2;
    } else {
        toSlider.style.zIndex = 0;
    }
}

const fromSlider = document.querySelector('#fromSlider');
const toSlider = document.querySelector('#toSlider');
const fromInput = document.querySelector('#fromInput');
const toInput = document.querySelector('#toInput');
fillSlider(fromSlider, toSlider, '#343434', '#343434', toSlider);
setToggleAccessible(toSlider);

fromSlider.oninput = () => controlFromSlider(fromSlider, toSlider, fromInput);
toSlider.oninput = () => controlToSlider(fromSlider, toSlider, toInput);
fromInput.oninput = () => controlFromInput(fromSlider, fromInput, toInput, toSlider);
toInput.oninput = () => controlToInput(toSlider, fromInput, toInput, toSlider);
